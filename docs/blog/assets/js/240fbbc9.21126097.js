"use strict";(self.webpackChunksea_ql_blog=self.webpackChunksea_ql_blog||[]).push([[763],{5680:(e,n,t)=>{t.d(n,{xA:()=>c,yg:()=>d});var r=t(6540);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},l=Object.keys(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(r=0;r<l.length;r++)t=l[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=r.createContext({}),p=function(e){var n=r.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=p(e.components);return r.createElement(s.Provider,{value:n},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},g=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),m=p(t),g=a,d=m["".concat(s,".").concat(g)]||m[g]||u[g]||l;return t?r.createElement(d,o(o({ref:n},c),{},{components:t})):r.createElement(d,o({ref:n},c))}));function d(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,o=new Array(l);o[0]=g;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i[m]="string"==typeof e?e:a,o[1]=i;for(var p=2;p<l;p++)o[p]=t[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,t)}g.displayName="MDXCreateElement"},1091:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>o,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>p});var r=t(8168),a=(t(6540),t(5680));const l={},o=void 0,i={permalink:"/blog/2024/05/28/getting-started-with-loco-seaorm",editUrl:"https://github.com/SeaQL/seaql.github.io/edit/master/Blog/blog/2024-05-28-getting-started-with-loco-seaorm.md",source:"@site/blog/2024-05-28-getting-started-with-loco-seaorm.md",title:"getting-started-with-loco-seaorm",description:"cargo install loco-cli",date:"2024-05-28T00:00:00.000Z",formattedDate:"May 28, 2024",tags:[],readingTime:14.05,hasTruncateMarker:!1,authors:[],frontMatter:{},prevItem:{title:"graphql-support-with-loco-seaography",permalink:"/blog/2024/07/01/graphql-support-with-loco-seaography"},nextItem:{title:"\u540c\u6b65\u4e0e\u5f02\u6b65 Rust \u4e4b\u95f4\u7684\u5f69\u8679\u6865",permalink:"/blog/2024-05-20-async-rainbow-bridge"}},s={authorsImageUrls:[]},p=[{value:"\u7528\u6237\u7ba1\u7406",id:"\u7528\u6237\u7ba1\u7406",level:2},{value:"\u6ce8\u518c",id:"\u6ce8\u518c",level:3},{value:"\u767b\u5f55",id:"\u767b\u5f55",level:3},{value:"\u8ba4\u8bc1",id:"\u8ba4\u8bc1",level:3},{value:"\u5904\u7406 REST \u8bf7\u6c42",id:"\u5904\u7406-rest-\u8bf7\u6c42",level:2},{value:"\u521b\u5efa\u7b14\u8bb0",id:"\u521b\u5efa\u7b14\u8bb0",level:3},{value:"\u5217\u51fa\u7b14\u8bb0",id:"\u5217\u51fa\u7b14\u8bb0",level:3},{value:"\u83b7\u53d6\u7b14\u8bb0",id:"\u83b7\u53d6\u7b14\u8bb0",level:3},{value:"\u5904\u7406\u6587\u4ef6\u4e0a\u4f20",id:"\u5904\u7406\u6587\u4ef6\u4e0a\u4f20",level:2},{value:"\u6587\u4ef6\u8868\u8fc1\u79fb",id:"\u6587\u4ef6\u8868\u8fc1\u79fb",level:3},{value:"\u6587\u4ef6\u6a21\u578b\u5b9a\u4e49",id:"\u6587\u4ef6\u6a21\u578b\u5b9a\u4e49",level:3},{value:"\u6587\u4ef6\u63a7\u5236\u5668",id:"\u6587\u4ef6\u63a7\u5236\u5668",level:3},{value:"\u4e0a\u4f20\u6587\u4ef6",id:"\u4e0a\u4f20\u6587\u4ef6",level:4},{value:"\u5217\u51fa\u6587\u4ef6",id:"\u5217\u51fa\u6587\u4ef6",level:4},{value:"\u67e5\u770b\u6587\u4ef6",id:"\u67e5\u770b\u6587\u4ef6",level:4},{value:"\u6587\u4ef6\u63a7\u5236\u5668\u8def\u7531",id:"\u6587\u4ef6\u63a7\u5236\u5668\u8def\u7531",level:4},{value:"\u9644\u52a0 Rust \u4f9d\u8d56\u9879",id:"\u9644\u52a0-rust-\u4f9d\u8d56\u9879",level:4},{value:"SQL Server \u652f\u6301",id:"sql-server-\u652f\u6301",level:2}],c={toc:p},m="wrapper";function u(e){let{components:n,...t}=e;return(0,a.yg)(m,(0,r.A)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-markdown"},'---\nslug: 2024-05-28-getting-started-with-loco-seaorm\ntitle: \u5f00\u59cb\u4f7f\u7528 Loco \u548c SeaORM\nauthor: Billy Chan\nauthor_title: SeaQL \u56e2\u961f\nauthor_url: https://github.com/billy1624\nauthor_image_url: https://avatars.githubusercontent.com/u/30400950?v=4\nimage: https://www.sea-ql.org/blog/img/Loco%20x%20SeaORM.png\ntags: [news]\n---\n\n<img src="/blog/img/Loco%20x%20SeaORM.png" />\n\n\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u6211\u4eec\u5c06\u4ece\u5934\u5f00\u59cb\u521b\u5efa\u4e00\u4e2a REST \u7b14\u8bb0\u672c\u540e\u7aef\uff0c\u5e76\u5728 Loco \u4e2d\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684 REST \u7aef\u70b9\u6765\u5904\u7406\u6587\u4ef6\u4e0a\u4f20\u3002\n\n\u5b8c\u6574\u7684\u6e90\u4ee3\u7801\u53ef\u4ee5\u5728 [\u8fd9\u91cc](https://github.com/SeaQL/sea-orm/tree/master/examples/loco_starter) \u627e\u5230\u3002REST API \u7684\u6587\u6863\u53ef\u4ee5\u5728 [\u8fd9\u91cc](https://documenter.getpostman.com/view/34752358/2sA3QmEF5q) \u67e5\u770b\u3002\n\n## \u4ec0\u4e48\u662f Loco\uff1f\n\n[Loco](https://loco.rs/) \u662f\u4e00\u4e2a\u53d7 Rails \u542f\u53d1\u7684 Rust \u7f51\u7edc\u6846\u67b6\u3002\u5b83\u5305\u542b\u8bb8\u591a Rails \u7684\u7279\u6027\u548c Rust \u7684\u6613\u7528\u6027\u3002Loco \u4e0e SeaORM \u65e0\u7f1d\u96c6\u6210\uff0c\u63d0\u4f9b\u4e00\u6d41\u7684\u5f00\u53d1\u4f53\u9a8c\uff01\n\n- \u901a\u8fc7 [axum](https://github.com/tokio-rs/axum) \u8fdb\u884c\u63a7\u5236\u5668\u548c\u8def\u7531\n- \u901a\u8fc7 [SeaORM](https://www.sea-ql.org/SeaORM/) \u8fdb\u884c\u6a21\u578b\u3001\u8fc1\u79fb\u548c ActiveRecord\n- \u901a\u8fc7 [serde](https://serde.rs/json.html) \u8fdb\u884c\u89c6\u56fe\n- \u65e0\u7f1d\u7684\u540e\u53f0\u4f5c\u4e1a\uff0c\u4f7f\u7528 [sidekiq-rs](https://github.com/film42/sidekiq-rs)\uff0c\u591a\u6a21\u5f0f\uff1a\u8fdb\u7a0b\u5185\u3001\u8fdb\u7a0b\u5916\u3001\u901a\u8fc7 Tokio \u7684\u5f02\u6b65\n- [...\u66f4\u591a](https://loco.rs/blog/hello-world/)\n\n## REST API \u542f\u52a8\u6a21\u677f\n\n\u5b89\u88c5 `loco-cli`\uff1a\n\n```sh\ncargo install loco-cli\n')),(0,a.yg)("p",null,(0,a.yg)("inlineCode",{parentName:"p"},"loco-cli")," \u63d0\u4f9b\u4e09\u4e2a\u542f\u52a8\u6a21\u677f\uff1a"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"SaaS \u542f\u52a8\u5668"),(0,a.yg)("li",{parentName:"ul"},"REST API \u542f\u52a8\u5668"),(0,a.yg)("li",{parentName:"ul"},"\u8f7b\u91cf\u7ea7\u670d\u52a1\u542f\u52a8\u5668")),(0,a.yg)("p",null,'\u5bf9\u4e8e\u672c\u6559\u7a0b\uff0c\u6211\u4eec\u9700\u8981\u9009\u62e9 "REST API \u542f\u52a8\u5668" \u6a21\u677f\uff1a'),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},"$ loco new\n\n\u2714  \u4f60\u5728\u4e00\u4e2a git \u4ed3\u5e93\u5185\u3002\u4f60\u662f\u5426\u5e0c\u671b\u7ee7\u7eed\uff1f \xb7 \u662f\n\u2714  \u5e94\u7528\u540d\u79f0\uff1f \xb7 loco_starter\n\u2714  \u4f60\u60f3\u6784\u5efa\u4ec0\u4e48\uff1f \xb7 REST API\uff08\u5e26\u6570\u636e\u5e93\u548c\u7528\u6237\u8ba4\u8bc1\uff09\n\n\ud83d\ude82 Loco \u5e94\u7528\u6210\u529f\u751f\u6210\u4e8e\uff1a\n/sea-orm/examples/loco_starter\n")),(0,a.yg)("p",null,"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u9700\u8981\u8bbe\u7f6e\u6211\u4eec\u7684 PostgreSQL \u6570\u636e\u5e93\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},'docker run -d -p 5432:5432 -e POSTGRES_USER=loco -e POSTGRES_DB=loco_starter_development -e POSTGRES_PASSWORD="loco" postgres:15.3-alpine\n')),(0,a.yg)("p",null,"\u5982\u679c\u4f60\u60f3\u4f7f\u7528 MySQL \u6216 SQLite \u4f5c\u4e3a\u6570\u636e\u5e93\uff0c\u8bf7\u66f4\u65b0 ",(0,a.yg)("inlineCode",{parentName:"p"},"loco_starter/config/development.yaml")," \u4e2d\u7684 ",(0,a.yg)("inlineCode",{parentName:"p"},"database.uri")," \u914d\u7f6e\u3002\u5e76\u5728 ",(0,a.yg)("inlineCode",{parentName:"p"},"loco_starter/Cargo.toml")," \u4e2d\u542f\u7528 SeaORM \u7684\u76f8\u5e94\u6570\u636e\u5e93\u540e\u7aef\u529f\u80fd\u6807\u5fd7\u3002"),(0,a.yg)("p",null,"\u73b0\u5728\uff0c\u542f\u52a8\u6211\u4eec\u7684 REST \u5e94\u7528\u7a0b\u5e8f\uff1a"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},"$ cargo loco start\n\n    Finished `dev` \u914d\u7f6e\u6587\u4ef6 [\u672a\u4f18\u5316 + \u8c03\u8bd5\u4fe1\u606f] \u76ee\u6807\uff08s\uff09\u5728 1m 42s \u5185\u5b8c\u6210\n     \u8fd0\u884c `target/debug/loco_starter-cli start`\n2024-05-20T06:56:42.724350Z  INFO app: loco_rs::config: \u4ece selected_path=\"config/development.yaml\" \u52a0\u8f7d\u73af\u5883 environment=development\n2024-05-20T06:56:42.740338Z  WARN app: loco_rs::boot: \u542f\u7528\u4e86\u6f02\u4eae\u7684\u56de\u6eaf\uff08\u8fd9\u5bf9\u5f00\u53d1\u5f88\u6709\u5e2e\u52a9\uff0c\u4f46\u5728\u751f\u4ea7\u4e2d\u4f1a\u5e26\u6765\u8fd0\u884c\u65f6\u5f00\u9500\u3002\u53ef\u4ee5\u901a\u8fc7\u5728\u914d\u7f6e yaml \u4e2d\u4f7f\u7528 `logger.pretty_backtrace` \u6765\u7981\u7528\uff09\u73af\u5883=development\n2024-05-20T06:56:42.833747Z  INFO app: loco_rs::db: \u81ea\u52a8\u8fc1\u79fb\u73af\u5883=development\n2024-05-20T06:56:42.845983Z  INFO app: sea_orm_migration::migrator: \u6b63\u5728\u5e94\u7528\u6240\u6709\u5f85\u5904\u7406\u7684\u8fc1\u79fb\u73af\u5883=development\n2024-05-20T06:56:42.850231Z  INFO app: sea_orm_migration::migrator: \u6b63\u5728\u5e94\u7528\u8fc1\u79fb 'm20220101_000001_users' \u73af\u5883=development\n2024-05-20T06:56:42.864095Z  INFO app: sea_orm_migration::migrator: \u8fc1\u79fb 'm20220101_000001_users' \u5df2\u5e94\u7528\u73af\u5883=development\n2024-05-20T06:56:42.865799Z  INFO app: sea_orm_migration::migrator: \u6b63\u5728\u5e94\u7528\u8fc1\u79fb 'm20231103_114510_notes' \u73af\u5883=development\n2024-05-20T06:56:42.873653Z  INFO app: sea_orm_migration::migrator: \u8fc1\u79fb 'm20231103_114510_notes' \u5df2\u5e94\u7528\u73af\u5883=development\n2024-05-20T06:56:42.875645Z  INFO app: loco_rs::boot: \u521d\u59cb\u5316\u5668\u52a0\u8f7d\u5b8c\u6210 initializers=\"\" environment=development\n2024-05-20T06:56:42.906072Z  INFO app: loco_rs::controller::app_routes: [GET] /api/_ping environment=development\n2024-05-20T06:56:42.906176Z  INFO app: loco_rs::controller::app_routes: [GET] /api/_health environment=development\n2024-05-20T06:56:42.906264Z  INFO app: loco_rs::controller::app_routes: [GET] /api/notes environment=development\n2024-05-20T06:56:42.906335Z  INFO app: loco_rs::controller::app_routes: [POST] /api/notes environment=development\n2024-05-20T06:56:42.906414Z  INFO app: loco_rs::controller::app_routes: [GET] /api/notes/:id environment=development\n2024-05-20T06:56:42.906501Z  INFO app: loco_rs::controller::app_routes: [DELETE] /api/notes/:id environment=development\n2024-05-20T06:56:42.906558Z  INFO app: loco_rs::controller::app_routes: [POST] /api/notes/:id environment=development\n2024-05-20T06:56:42.906609Z  INFO app: loco_rs::controller::app_routes: [POST] /api/auth/register environment=development\n2024-05-20T06:56:42.906680Z  INFO app: loco_rs::controller::app_routes: [POST] /api/auth/verify environment=development\n2024-05-20T06:56:42.906753Z  INFO app: loco_rs::controller::app_routes: [POST] /api/auth/login environment=development\n2024-05-20T06:56:42.906838Z  INFO app: loco_rs::controller::app_routes: [POST] /api/auth/forgot environment=development\n2024-05-20T06:56:42.906931Z  INFO app: loco_rs::controller::app_routes: [POST] /api/auth/reset environment=development\n2024-05-20T06:56:42.907012Z  INFO app: loco_rs::controller::app_routes: [GET] /api/user/current environment=development\n2024-05-20T06:56:42.907309Z  INFO app: loco_rs::controller::app_routes: [Middleware] \u6dfb\u52a0\u9650\u5236\u8d1f\u8f7d\u6570\u636e=\"5mb\" environment=development\n2024-05-20T06:56:42.907440Z  INFO app: loco_rs::controller::app_routes: [Middleware] \u6dfb\u52a0\u65e5\u5fd7\u8ffd\u8e2a ID environment=development\n2024-05-20T06:56:42.907714Z  INFO app: loco_rs::controller::app_routes: [Middleware] \u6dfb\u52a0 CORS \u73af\u5883=development\n2024-05-20T06:56:42.907788Z  INFO app: loco_rs::controller::app_routes: [Middleware] \u6dfb\u52a0 ETag \u5c42\u73af\u5883=development\n\n                      \u2584     \u2580\n                                 \u2580  \u2584\n                  \u2584       \u2580     \u2584  \u2584 \u2584\u2580\n                                    \u2584 \u2580\u2584\u2584\n                        \u2584     \u2580    \u2580  \u2580\u2584\u2580\u2588\u2584\n                                          \u2580\u2588\u2584\n\u2584\u2584\u2584\u2584\u2584\u2584\u2584  \u2584\u2584\u2584\u2584\u2584\u2584\u2584\u2584\u2584   \u2584\u2584\u2584\u2584\u2584\u2584\u2584\u2584\u2584\u2584\u2584 \u2584\u2584\u2584\u2584\u2584\u2584\u2584\u2584\u2584 \u2580\u2580\u2588\n \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588 \u2580\u2588\n \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588   \u2580\u2580\u2580 \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588 \u2584\u2588\u2584\n \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588       \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2584\n \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588   \u2584\u2584\u2584 \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\n \u2588\u2588\u2588\u2588\u2588\u2588  \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588  \u2588\u2588\u2588\u2588   \u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588   \u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2580\n   \u2580\u2580\u2580\u2588\u2588\u2584 \u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580  \u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580  \u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580 \u2588\u2588\u2580\n       \u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\u2580\n                https://loco.rs\n\n\u73af\u5883\uff1a\u5f00\u53d1\n   \u6570\u636e\u5e93\uff1a\u81ea\u52a8\u8fc1\u79fb\n     \u65e5\u5fd7\uff1a\u8c03\u8bd5\n\u7f16\u8bd1\uff1a\u8c03\u8bd5\n      \u6a21\u5f0f\uff1a\u670d\u52a1\u5668\n\n\u76d1\u542c\u5730\u5740 [::]:3000\n")),(0,a.yg)("p",null,"\u4ece\u4e0a\u9762\u7684\u65e5\u5fd7\u6d88\u606f\u4e2d\uff0c\u6211\u4eec\u770b\u5230\uff1a"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"\u6570\u636e\u5e93\u8fc1\u79fb\u5df2\u88ab\u5e94\u7528"),(0,a.yg)("li",{parentName:"ul"},"\u6240\u6709\u53ef\u7528\u7684 REST API")),(0,a.yg)("p",null,"\u68c0\u67e5\u5e94\u7528\u7a0b\u5e8f\u662f\u5426\u76d1\u542c\u8bf7\u6c42\uff1a"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},"$ curl --location 'http://localhost:3000/api/_ping'\n\n{\"ok\":true}\n")),(0,a.yg)("h2",{id:"\u7528\u6237\u7ba1\u7406"},"\u7528\u6237\u7ba1\u7406"),(0,a.yg)("p",null,"\u542f\u52a8\u6a21\u677f\u9644\u5e26\u4e86\u4e00\u4e2a\u57fa\u672c\u7684\u7528\u6237\u7ba1\u7406\u6a21\u5757\u3002"),(0,a.yg)("h3",{id:"\u6ce8\u518c"},"\u6ce8\u518c"),(0,a.yg)("p",null,"\u5e38\u89c1\u505a\u6cd5\u662f\u5411\u63d0\u4f9b\u7684\u7535\u5b50\u90ae\u4ef6\u53d1\u9001\u9a8c\u8bc1\u90ae\u4ef6\u3002\u7136\u800c\uff0c\u8fd9\u9700\u8981\u4e00\u4e2a SMTP \u670d\u52a1\u5668\uff0c\u800c\u8fd9\u4e0d\u662f\u672c\u535a\u5ba2\u6587\u7ae0\u7684\u91cd\u70b9\u3002\u56e0\u6b64\uff0c\u6211\u5c06\u8df3\u8fc7\u90ae\u4ef6\u9a8c\u8bc1\uff1a"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-diff",metastring:'title="loco_starter/src/controllers/auth.rs"',title:'"loco_starter/src/controllers/auth.rs"'},'#[debug_handler]\nasync fn register(\n    State(ctx): State<AppContext>,\n    Json(params): Json<RegisterParams>,\n) -> Result<Response> {\n    let res = users::Model::create_with_password(&ctx.db, &params).await;\n\n    let user = match res {\n        Ok(user) => user,\n        Err(err) => {\n            tracing::info!(\n                message = err.to_string(),\n                user_email = &params.email,\n                "\u65e0\u6cd5\u6ce8\u518c\u7528\u6237",\n            );\n            return format::json(());\n        }\n    };\n\n+   // \u8df3\u8fc7\u7535\u5b50\u90ae\u4ef6\u9a8c\u8bc1\uff0c\u6240\u6709\u65b0\u6ce8\u518c\u7684\u7528\u6237\u90fd\u88ab\u89c6\u4e3a\u5df2\u9a8c\u8bc1\n+   let _user = user\n+       .into_active_model()\n+       .verified(&ctx.db)\n+       .await?;\n\n+   // \u8df3\u8fc7\u53d1\u9001\u9a8c\u8bc1\u90ae\u4ef6\uff0c\u56e0\u4e3a\u6211\u4eec\u6ca1\u6709\u90ae\u4ef6\u670d\u52a1\u5668\n+   /*\n    let user = user\n        .into_active_model()\n        .set_email_verification_sent(&ctx.db)\n        .await?;\n\n    AuthMailer::send_welcome(&ctx, &user).await?;\n+   */\n\n    format::json(())\n}\n')),(0,a.yg)("p",null,"\u7f16\u8bd1\u5e76\u8fd0\u884c\u5e94\u7528\u7a0b\u5e8f\uff0c\u7136\u540e\u6ce8\u518c\u4e00\u4e2a\u65b0\u7528\u6237\u8d26\u6237\uff1a"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},'$ curl --location \'http://localhost:3000/api/auth/register\' \\\n--data-raw \'{\n    "name": "Billy",\n    "email": "cwchan.billy@gmail.com",\n    "password": "password"\n}\'\n\nnull\n')),(0,a.yg)("h3",{id:"\u767b\u5f55"},"\u767b\u5f55"),(0,a.yg)("p",null,"\u4f60\u5e94\u8be5\u5728\u6570\u636e\u5e93\u4e2d\u770b\u5230\u4e00\u6761\u65b0\u7684 ",(0,a.yg)("inlineCode",{parentName:"p"},"user")," \u8bb0\u5f55\u3002"),(0,a.yg)("p",null,"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4f7f\u7528\u76f8\u5e94\u7684\u7535\u5b50\u90ae\u4ef6\u548c\u5bc6\u7801\u767b\u5f55\u7528\u6237\u8d26\u6237\uff1a"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},'$ curl --location \'http://localhost:3000/api/auth/login\' \\\n--data-raw \'{\n    "email": "cwchan.billy@gmail.com",\n    "password": "password"\n}\'\n\n{\n  "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJwaWQiOiIxMWQwMWFmMy02ZmUyLTQ0ZjMtODlmMC1jMDJjZWMzOTc0MWQiLCJleHAiOjE3MTY3OTU3NjR9.i1OElxy33rkorkxk6QpTG1Kg4_Q8O0jqBJ2i82nltkcQYZsLmSSnrxtdtlfdvV0ccJ3hQA3JoY9L13cjz2uSCw",\n  "pid": "11d01af3-6fe2-44f3-89f0-c02cec39741d",\n  "name": "Billy",\n  "is_verified": true\n}\n')),(0,a.yg)("h3",{id:"\u8ba4\u8bc1"},"\u8ba4\u8bc1"),(0,a.yg)("p",null,"\u4e0a\u8ff0\u7684 JWT \u4ee4\u724c\u5c06\u5728\u7528\u6237\u8ba4\u8bc1\u4e2d\u4f7f\u7528\u3002\u4f60\u5fc5\u987b\u8bbe\u7f6e ",(0,a.yg)("inlineCode",{parentName:"p"},"Authorization")," \u5934\u4ee5\u8bbf\u95ee\u4efb\u4f55\u9700\u8981\u7528\u6237\u767b\u5f55\u7684 REST \u7aef\u70b9\u3002"),(0,a.yg)("p",null,"\u4f8b\u5982\uff0c\u83b7\u53d6\u5f53\u524d\u7528\u6237\u7684\u7528\u6237\u4fe1\u606f\uff1a"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},'$ curl --location \'http://localhost:3000/api/user/current\' \\\n--header \'Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJwaWQiOiIxMWQwMWFmMy02ZmUyLTQ0ZjMtODlmMC1jMDJjZWMzOTc0MWQiLCJleHAiOjE3MTY3OTU3NjR9.i1OElxy33rkorkxk6QpTG1Kg4_Q8O0jqBJ2i82nltkcQYZsLmSSnrxtdtlfdvV0ccJ3hQA3JoY9L13cjz2uSCw\'\n\n{\n    "pid":"11d01af3-6fe2-44f3-89f0-c02cec39741d",\n    "name":"Billy",\n    "email":"cwchan.billy@gmail.com"\n}\n')),(0,a.yg)("h2",{id:"\u5904\u7406-rest-\u8bf7\u6c42"},"\u5904\u7406 REST \u8bf7\u6c42"),(0,a.yg)("p",null,"\u542f\u52a8\u5e94\u7528\u7a0b\u5e8f\u9644\u5e26\u4e86\u4e00\u4e2a\u7528\u4e8e ",(0,a.yg)("inlineCode",{parentName:"p"},"notes")," \u8868\u7684\u63a7\u5236\u5668\u3002"),(0,a.yg)("h3",{id:"\u521b\u5efa\u7b14\u8bb0"},"\u521b\u5efa\u7b14\u8bb0"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},'$ curl --location \'http://localhost:3000/api/notes\' \\\n--header \'Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJwaWQiOiIxMWQwMWFmMy02ZmUyLTQ0ZjMtODlmMC1jMDJjZWMzOTc0MWQiLCJleHAiOjE3MTY3OTU3NjR9.i1OElxy33rkorkxk6QpTG1Kg4_Q8O0jqBJ2i82nltkcQYZsLmSSnrxtdtlfdvV0ccJ3hQA3JoY9L13cjz2uSCw\' \\\n--data \'{\n    "title": "\u5f00\u59cb\u4f7f\u7528 Loco \u548c SeaORM",\n    "content": "\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u6211\u4eec\u5c06\u4ece\u5934\u5f00\u59cb\u521b\u5efa\u4e00\u4e2a REST \u7b14\u8bb0\u672c\u540e\u7aef\uff0c\u5e76\u5728 Loco \u4e2d\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684 REST \u7aef\u70b9\u6765\u5904\u7406\u6587\u4ef6\u4e0a\u4f20\u3002"\n}\'\n\n{\n  "created_at": "2024-05-20T08:43:45.408449",\n  "updated_at": "2024-05-20T08:43:45.408449",\n  "id": 1,\n  "title": "\u5f00\u59cb\u4f7f\u7528 Loco \u548c SeaORM",\n  "content": "\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u6211\u4eec\u5c06\u4ece\u5934\u5f00\u59cb\u521b\u5efa\u4e00\u4e2a REST \u7b14\u8bb0\u672c\u540e\u7aef\uff0c\u5e76\u5728 Loco \u4e2d\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684 REST \u7aef\u70b9\u6765\u5904\u7406\u6587\u4ef6\u4e0a\u4f20\u3002"\n}\n')),(0,a.yg)("h3",{id:"\u5217\u51fa\u7b14\u8bb0"},"\u5217\u51fa\u7b14\u8bb0"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},'$ curl --location \'http://localhost:3000/api/notes\' \\\n--header \'Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJwaWQiOiIxMWQwMWFmMy02ZmUyLTQ0ZjMtODlmMC1jMDJjZWMzOTc0MWQiLCJleHAiOjE3MTY3OTU3NjR9.i1OElxy33rkorkxk6QpTG1Kg4_Q8O0jqBJ2i82nltkcQYZsLmSSnrxtdtlfdvV0ccJ3hQA3JoY9L13cjz2uSCw\'\n\n[\n  {\n    "created_at": "2024-05-20T08:43:45.408449",\n    "updated_at": "2024-05-20T08:43:45.408449",\n    "id": 1,\n    "title": "\u5f00\u59cb\u4f7f\u7528 Loco \u548c SeaORM",\n    "content": "\u5728\u672c\u6559\u7a0b\u4e2d\uff0c\u6211\u4eec\u5c06\u4ece\u5934\u5f00\u59cb\u521b\u5efa\u4e00\u4e2a REST \u7b14\u8bb0\u672c\u540e\u7aef\uff0c\u5e76\u5728 Loco \u4e2d\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684 REST \u7aef\u70b9\u6765\u5904\u7406\u6587\u4ef6\u4e0a\u4f20\u3002"\n  },\n  {\n    "created_at": "2024-05-20T08:45:38.973130",\n    "updated_at": "2024-05-20T08:45:38.973130",\n    "id": 2,\n    "title": "\u4ecb\u7ecd SeaORM X",\n    "content": "SeaORM X \u662f\u5efa\u7acb\u5728 SeaORM \u4e4b\u4e0a\u7684\uff0c\u652f\u6301 SQL Server"\n  }\n]\n')),(0,a.yg)("h3",{id:"\u83b7\u53d6\u7b14\u8bb0"},"\u83b7\u53d6\u7b14\u8bb0"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},'$ curl --location \'http://localhost:3000/api/notes/2\' \\\n--header \'Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzUxMiJ9.eyJwaWQiOiIxMWQwMWFmMy02ZmUyLTQ0ZjMtODlmMC1jMDJjZWMzOTc0MWQiLCJleHAiOjE3MTY3OTU3NjR9.i1OElxy33rkorkxk6QpTG1Kg4_Q8O0jqBJ2i82nltkcQYZsLmSSnrxtdtlfdvV0ccJ3hQA3JoY9L13cjz2uSCw\'\n\n{\n  "created_at": "2024-05-20T08:45:38.973130",\n  "updated_at": "2024-05-20T08:45:38.973130",\n  "id": 2,\n  "title": "\u4ecb\u7ecd SeaORM X",\n  "content": "SeaORM X \u662f\u5efa\u7acb\u5728 SeaORM \u4e4b\u4e0a\u7684\uff0c\u652f\u6301 SQL Server"\n}\n')),(0,a.yg)("h2",{id:"\u5904\u7406\u6587\u4ef6\u4e0a\u4f20"},"\u5904\u7406\u6587\u4ef6\u4e0a\u4f20"),(0,a.yg)("p",null,"\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u6dfb\u52a0\u4e00\u4e2a\u6587\u4ef6\u4e0a\u4f20\u529f\u80fd\uff0c\u7528\u6237\u53ef\u4ee5\u4e0a\u4f20\u4e0e\u7b14\u8bb0\u76f8\u5173\u7684\u6587\u4ef6\u3002"),(0,a.yg)("h3",{id:"\u6587\u4ef6\u8868\u8fc1\u79fb"},"\u6587\u4ef6\u8868\u8fc1\u79fb"),(0,a.yg)("p",null,"\u4e3a\u65b0\u7684 ",(0,a.yg)("inlineCode",{parentName:"p"},"files")," \u8868\u521b\u5efa\u4e00\u4e2a\u8fc1\u79fb\u6587\u4ef6\u3002\u6bcf\u884c ",(0,a.yg)("inlineCode",{parentName:"p"},"files")," \u53c2\u8003\u6570\u636e\u5e93\u4e2d\u7684\u7279\u5b9a ",(0,a.yg)("inlineCode",{parentName:"p"},"notes"),"\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-rust",metastring:'title="loco_starter/migration/src/m20240520_173001_files.rs"',title:'"loco_starter/migration/src/m20240520_173001_files.rs"'},'use sea_orm_migration::{prelude::*, schema::*};\n\nuse super::m20231103_114510_notes::Notes;\n\n#[derive(DeriveMigrationName)]\npub struct Migration;\n\n#[async_trait::async_trait]\nimpl MigrationTrait for Migration {\n    async fn up(&self, manager: &SchemaManager) -> Result<(), DbErr> {\n        manager\n            .create_table(\n                table_auto(Files::Table)\n                    .col(pk_auto(Files::Id))\n                    .col(integer(Files::NotesId))\n                    .col(string(Files::FilePath))\n                    .foreign_key(\n                        ForeignKey::create()\n                            .name("FK_files_notes_id")\n                            .from(Files::Table, Files::NotesId)\n                            .to(Notes::Table, Notes::Id),\n                    )\n                    .to_owned(),\n            )\n            .await\n    }\n\n    async fn down(&self, manager: &SchemaManager) -> Result<(), DbErr> {\n        manager\n            .drop_table(Table::drop().table(Files::Table).to_owned())\n            .await\n    }\n}\n\n#[derive(DeriveIden)]\npub enum Files {\n    Table,\n    Id,\n    NotesId,\n    FilePath,\n}\n')),(0,a.yg)("p",null,"\u7136\u540e\uff0c\u6211\u4eec\u9700\u8981\u542f\u7528\u65b0\u7684\u8fc1\u79fb\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-diff",metastring:'title="loco_starter/migration/src/lib.rs"',title:'"loco_starter/migration/src/lib.rs"'},"#![allow(elided_lifetimes_in_paths)]\n#![allow(clippy::wildcard_imports)]\npub use sea_orm_migration::prelude::*;\n\nmod m20220101_000001_users;\nmod m20231103_114510_notes;\n+ mod m20240520_173001_files;\n\npub struct Migrator;\n\n#[async_trait::async_trait]\nimpl MigratorTrait for Migrator {\n    fn migrations() -> Vec<Box<dyn MigrationTrait>> {\n        vec![\n            Box::new(m20220101_000001_users::Migration),\n            Box::new(m20231103_114510_notes::Migration),\n+           Box::new(m20240520_173001_files::Migration),\n        ]\n    }\n}\n")),(0,a.yg)("p",null,"\u7f16\u8bd1\u5e76\u542f\u52a8\u5e94\u7528\u7a0b\u5e8f\uff0c\u5b83\u5e94\u8be5\u5728\u542f\u52a8\u65f6\u8fd0\u884c\u6211\u4eec\u7684\u65b0\u8fc1\u79fb\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},"$ cargo loco start\n\n...\n2024-05-20T09:39:59.607525Z  INFO app: loco_rs::db: \u81ea\u52a8\u8fc1\u79fb\u73af\u5883=development\n2024-05-20T09:39:59.611997Z  INFO app: sea_orm_migration::migrator: \u6b63\u5728\u5e94\u7528\u6240\u6709\u5f85\u5904\u7406\u7684\u8fc1\u79fb\u73af\u5883=development\n2024-05-20T09:39:59.621699Z  INFO app: sea_orm_migration::migrator: \u6b63\u5728\u5e94\u7528\u8fc1\u79fb 'm20240520_173001_files' \u73af\u5883=development\n2024-05-20T09:39:59.643886Z  INFO app: sea_orm_migration::migrator: \u8fc1\u79fb 'm20240520_173001_files' \u5df2\u88ab\u5e94\u7528\u73af\u5883=development\n...\n")),(0,a.yg)("h3",{id:"\u6587\u4ef6\u6a21\u578b\u5b9a\u4e49"},"\u6587\u4ef6\u6a21\u578b\u5b9a\u4e49"),(0,a.yg)("p",null,"\u5b9a\u4e49 ",(0,a.yg)("inlineCode",{parentName:"p"},"files")," \u5b9e\u4f53\u6a21\u578b\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-rust",metastring:'title="loco_starter/src/models/_entities/files.rs"',title:'"loco_starter/src/models/_entities/files.rs"'},'use sea_orm::entity::prelude::*;\nuse serde::{Deserialize, Serialize};\n\n#[derive(Clone, Debug, PartialEq, DeriveEntityModel, Eq, Serialize, Deserialize)]\n#[sea_orm(table_name = "files")]\npub struct Model {\n    pub created_at: DateTime,\n    pub updated_at: DateTime,\n    #[sea_orm(primary_key)]\n    pub id: i32,\n    pub notes_id: i32,\n    pub file_path: String,\n}\n\n#[derive(Copy, Clone, Debug, EnumIter, DeriveRelation)]\npub enum Relation {\n    #[sea_orm(\n        belongs_to = "super::notes::Entity",\n        from = "Column::NotesId",\n        to = "super::notes::Column::Id"\n    )]\n    Notes,\n}\n\nimpl Related<super::notes::Entity> for Entity {\n    fn to() -> RelationDef {\n        Relation::Notes.def()\n    }\n}\n')),(0,a.yg)("p",null,"\u5728\u7236\u6a21\u5757\u4e2d\u5b9e\u73b0 ",(0,a.yg)("inlineCode",{parentName:"p"},"ActiveModelBehavior"),"\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-rust",metastring:'title="loco_starter/src/models/files.rs"',title:'"loco_starter/src/models/files.rs"'},"use sea_orm::entity::prelude::*;\n\nuse super::_entities::files::ActiveModel;\n\nimpl ActiveModelBehavior for ActiveModel {\n    // \u5728\u4e0b\u9762\u6269\u5c55 activemodel\uff08\u4fdd\u7559\u751f\u6210\u5668\u7684\u6ce8\u91ca\uff09\n}\n")),(0,a.yg)("h3",{id:"\u6587\u4ef6\u63a7\u5236\u5668"},"\u6587\u4ef6\u63a7\u5236\u5668"),(0,a.yg)("p",null,"\u63a7\u5236\u5668\u662f\u6211\u4eec\u5904\u7406\u6587\u4ef6\u4e0a\u4f20\u3001\u5217\u51fa\u548c\u67e5\u770b\u7684\u5730\u65b9\u3002"),(0,a.yg)("h4",{id:"\u4e0a\u4f20\u6587\u4ef6"},"\u4e0a\u4f20\u6587\u4ef6"),(0,a.yg)("p",null,"\u4ee5\u4e0b\u4e0a\u4f20\u5904\u7406\u7a0b\u5e8f\u5141\u8bb8\u5728\u5355\u4e2a POST \u8bf7\u6c42\u4e2d\u4e0a\u4f20\u591a\u4e2a\u6587\u4ef6\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-rust",metastring:'title="loco_starter/src/controllers/files.rs"',title:'"loco_starter/src/controllers/files.rs"'},'#[debug_handler]\npub async fn upload(\n    _auth: auth::JWT,\n    Path(notes_id): Path<i32>,\n    State(ctx): State<AppContext>,\n    mut multipart: Multipart,\n) -> Result<Response> {\n    // \u6536\u96c6\u6240\u6709\u4e0a\u4f20\u7684\u6587\u4ef6\n    let mut files = Vec::new();\n\n    // \u8fed\u4ee3 POST \u4e3b\u4f53\u4e2d\u7684\u6240\u6709\u6587\u4ef6\n    while let Some(field) = multipart.next_field().await.map_err(|err| {\n        tracing::error!(error = ?err,"\u65e0\u6cd5\u8bfb\u53d6 multipart");\n        Error::BadRequest("\u65e0\u6cd5\u8bfb\u53d6 multipart".into())\n    })? {\n        // \u83b7\u53d6\u6587\u4ef6\u540d\n        let file_name = match field.file_name() {\n            Some(file_name) => file_name.to_string(),\n            _ => return Err(Error::BadRequest("\u672a\u627e\u5230\u6587\u4ef6\u540d".into())),\n        };\n\n        // \u83b7\u53d6\u6587\u4ef6\u5185\u5bb9\u4e3a\u5b57\u8282\n        let content = field.bytes().await.map_err(|err| {\n            tracing::error!(error = ?err,"\u65e0\u6cd5\u8bfb\u53d6\u5b57\u8282");\n            Error::BadRequest("\u65e0\u6cd5\u8bfb\u53d6\u5b57\u8282".into())\n        })?;\n\n        // \u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\u5939\u4ee5\u5b58\u50a8\u4e0a\u4f20\u7684\u6587\u4ef6\n        let now = chrono::offset::Local::now()\n            .format("%Y%m%d_%H%M%S")\n            .to_string();\n        let uuid = uuid::Uuid::new_v4().to_string();\n        let folder = format!("{now}_{uuid}");\n        let upload_folder = PathBuf::from(UPLOAD_DIR).join(&folder);\n        fs::create_dir_all(&upload_folder).await?;\n\n        // \u5c06\u6587\u4ef6\u5199\u5165\u65b0\u521b\u5efa\u7684\u6587\u4ef6\u5939\n        let path = upload_folder.join(file_name);\n        let mut f = fs::OpenOptions::new()\n            .create_new(true)\n            .write(true)\n            .open(&path)\n            .await?;\n        f.write_all(&content).await?;\n        f.flush().await?;\n\n        // \u5728\u6570\u636e\u5e93\u4e2d\u8bb0\u5f55\u6587\u4ef6\u4e0a\u4f20\n        let file = files::ActiveModel {\n            notes_id: ActiveValue::Set(notes_id),\n            file_path: ActiveValue::Set(\n                path.strip_prefix(UPLOAD_DIR)\n                    .unwrap()\n                    .to_str()\n                    .unwrap()\n                    .to_string(),\n            ),\n            ..Default::default()\n        }\n        .insert(&ctx.db)\n        .await?;\n\n        files.push(file);\n    }\n\n    format::json(files)\n}\n')),(0,a.yg)("p",null,"\u5c1d\u8bd5\u5728\u5355\u4e2a POST \u8bf7\u6c42\u4e2d\u4e0a\u4f20\u591a\u4e2a\u6587\u4ef6\uff1a"),(0,a.yg)("p",null,(0,a.yg)("img",{parentName:"p",src:"https://www.sea-ql.org/blog/img/Loco%20x%20SeaORM%20upload%20file.png",alt:null})),(0,a.yg)("p",null,"\u6240\u6709\u4e0a\u4f20\u7684\u6587\u4ef6\u90fd\u4fdd\u5b58\u5728 ",(0,a.yg)("inlineCode",{parentName:"p"},"uploads")," \u76ee\u5f55\u4e2d\uff1a"),(0,a.yg)("p",null,(0,a.yg)("img",{parentName:"p",src:"https://www.sea-ql.org/blog/img/Loco%20x%20SeaORM%20upload%20directory.png",alt:null})),(0,a.yg)("h4",{id:"\u5217\u51fa\u6587\u4ef6"},"\u5217\u51fa\u6587\u4ef6"),(0,a.yg)("p",null,"\u5217\u51fa\u4e0e\u7279\u5b9a ",(0,a.yg)("inlineCode",{parentName:"p"},"notes_id")," \u76f8\u5173\u7684\u6240\u6709 ",(0,a.yg)("inlineCode",{parentName:"p"},"files"),"\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-rust",metastring:'title="loco_starter/src/controllers/files.rs"',title:'"loco_starter/src/controllers/files.rs"'},"#[debug_handler]\npub async fn list(\n    _auth: auth::JWT,\n    Path(notes_id): Path<i32>,\n    State(ctx): State<AppContext>,\n) -> Result<Response> {\n    // \u83b7\u53d6\u4e3a\u7279\u5b9a\u7b14\u8bb0\u4e0a\u4f20\u7684\u6240\u6709\u6587\u4ef6\n    let files = files::Entity::find()\n        .filter(files::Column::NotesId.eq(notes_id))\n        .order_by_asc(files::Column::Id)\n        .all(&ctx.db)\n        .await?;\n\n    format::json(files)\n}\n")),(0,a.yg)("p",null,(0,a.yg)("img",{parentName:"p",src:"https://www.sea-ql.org/blog/img/Loco%20x%20SeaORM%20list%20file.png",alt:null})),(0,a.yg)("h4",{id:"\u67e5\u770b\u6587\u4ef6"},"\u67e5\u770b\u6587\u4ef6"),(0,a.yg)("p",null,"\u67e5\u770b\u7279\u5b9a\u7684 ",(0,a.yg)("inlineCode",{parentName:"p"},"files"),"\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-rust",metastring:'title="loco_starter/src/controllers/files.rs"',title:'"loco_starter/src/controllers/files.rs"'},'#[debug_handler]\npub async fn view(\n    _auth: auth::JWT,\n    Path(files_id): Path<i32>,\n    State(ctx): State<AppContext>,\n) -> Result<Response> {\n    // \u4ece\u6570\u636e\u5e93\u4e2d\u83b7\u53d6\u6587\u4ef6\u4fe1\u606f\n    let file = files::Entity::find_by_id(files_id)\n        .one(&ctx.db)\n        .await?\n        .expect("\u672a\u627e\u5230\u6587\u4ef6");\n\n    // \u6d41\u5f0f\u4f20\u8f93\u6587\u4ef6\n    let file = fs::File::open(format!("{UPLOAD_DIR}/{}", file.file_path)).await?;\n    let stream = ReaderStream::new(file);\n    let body = Body::from_stream(stream);\n\n    Ok(format::render().response().body(body)?)\n}\n')),(0,a.yg)("p",null,(0,a.yg)("img",{parentName:"p",src:"https://www.sea-ql.org/blog/img/Loco%20x%20SeaORM%20view%20file.png",alt:null})),(0,a.yg)("h4",{id:"\u6587\u4ef6\u63a7\u5236\u5668\u8def\u7531"},"\u6587\u4ef6\u63a7\u5236\u5668\u8def\u7531"),(0,a.yg)("p",null,"\u5c06\u6211\u4eec\u65b0\u5b9a\u4e49\u7684\u6587\u4ef6\u5904\u7406\u5668\u6dfb\u52a0\u5230\u5e94\u7528\u7a0b\u5e8f\u8def\u7531\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-rust",metastring:'title="loco_starter/src/controllers/files.rs"',title:'"loco_starter/src/controllers/files.rs"'},'pub fn routes() -> Routes {\n    // \u7ed1\u5b9a\u8def\u7531\n    Routes::new()\n        .prefix("files")\n        .add("/upload/:notes_id", post(upload))\n        .add("/list/:notes_id", get(list))\n        .add("/view/:files_id", get(view))\n}\n')),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-diff",metastring:'title="loco_starter/src/app.rs"',title:'"loco_starter/src/app.rs"'},'pub struct App;\n\n#[async_trait]\nimpl Hooks for App {\n    // ...\n\n    fn routes(_ctx: &AppContext) -> AppRoutes {\n        AppRoutes::with_default_routes()\n            .prefix("/api")\n            .add_route(controllers::notes::routes())\n            .add_route(controllers::auth::routes())\n            .add_route(controllers::user::routes())\n+           .add_route(controllers::files::routes())\n    }\n\n    // ...\n}\n')),(0,a.yg)("h4",{id:"\u9644\u52a0-rust-\u4f9d\u8d56\u9879"},"\u9644\u52a0 Rust \u4f9d\u8d56\u9879"),(0,a.yg)("p",null,"\u8bf7\u8bb0\u5f97\u5728 ",(0,a.yg)("inlineCode",{parentName:"p"},"axum")," \u4e2d\u542f\u7528 ",(0,a.yg)("inlineCode",{parentName:"p"},"multipart")," \u5e76\u6dfb\u52a0 ",(0,a.yg)("inlineCode",{parentName:"p"},"tokio-util")," \u4f9d\u8d56\u9879\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-diff",metastring:'title="loco_starter/Cargo.toml"',title:'"loco_starter/Cargo.toml"'},'- axum = "0.7.1"\n+ axum = { version = "0.7.1", features = ["multipart"] }\n\n+ tokio-util = "0.7.11"\n')),(0,a.yg)("h2",{id:"sql-server-\u652f\u6301"},"SQL Server \u652f\u6301"),(0,a.yg)("p",null,(0,a.yg)("a",{parentName:"p",href:"https://www.sea-ql.org/SeaORM-X/"},"SeaORM \u7684 SQL Server")," \u73b0\u5df2\u63d0\u4f9b\u5c01\u95ed\u6d4b\u8bd5\u3002\u5982\u679c\u4f60\u611f\u5174\u8da3\uff0c\u8bf7\u5728 ",(0,a.yg)("a",{parentName:"p",href:"https://forms.office.com/r/1MuRPJmYBR"},"\u8fd9\u91cc")," \u6ce8\u518c\u3002"),(0,a.yg)("p",null,"\u4ece ",(0,a.yg)("inlineCode",{parentName:"p"},"sea-orm")," \u8fc1\u79fb\u5230 ",(0,a.yg)("inlineCode",{parentName:"p"},"sea-orm-x")," \u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u4e24\u4e2a\u7b80\u5355\u6b65\u9aa4\u3002\u9996\u5148\uff0c\u5c06\u73b0\u6709\u7684 ",(0,a.yg)("inlineCode",{parentName:"p"},"sea-orm")," \u4f9d\u8d56\u9879\u66f4\u65b0\u4e3a ",(0,a.yg)("inlineCode",{parentName:"p"},"sea-orm-x")," \u5e76\u542f\u7528 ",(0,a.yg)("inlineCode",{parentName:"p"},"sqlz-mssql")," \u529f\u80fd\u3002\u8bf7\u6ce8\u610f\uff0c\u60a8\u53ef\u80fd\u9700\u8981\u4fee\u8865 SeaORM \u4f9d\u8d56\u9879\u4ee5\u89e3\u51b3\u4e0a\u6e38\u4f9d\u8d56\u9879\u7684\u95ee\u9898\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-toml",metastring:'title="Cargo.toml"',title:'"Cargo.toml"'},'sea-orm = { path = "<SEA_ORM_X_ROOT>/sea-orm-x", features = ["runtime-async-std-rustls", "sqlz-mssql"] }\nsea-orm-migration = { path = "<SEA_ORM_X_ROOT>/sea-orm-x/sea-orm-migration" }\n\n# \u4fee\u8865 SeaORM \u4f9d\u8d56\u9879\u4ee5\u89e3\u51b3\u4e0a\u6e38\u4f9d\u8d56\u9879\n[patch.crates-io]\nsea-orm = { path = "<SEA_ORM_X_ROOT>/sea-orm-x" }\nsea-orm-migration = { path = "<SEA_ORM_X_ROOT>/sea-orm-x/sea-orm-migration" }\n')),(0,a.yg)("p",null,"\u5176\u6b21\uff0c\u66f4\u65b0\u8fde\u63a5\u5b57\u7b26\u4e32\u4ee5\u8fde\u63a5\u5230 MSSQL \u6570\u636e\u5e93\u3002"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre",className:"language-sh"},"# \u5982\u679c\u6a21\u5f0f\u662f `dbo`\uff0c\u53ea\u9700\u7f16\u5199\uff1a\nmssql://username:password@host/database\n\n# \u6216\u8005\uff0c\u901a\u8fc7\u63d0\u4f9b\u989d\u5916\u7684 `currentSchema` \u67e5\u8be2\u53c2\u6570\u6765\u6307\u5b9a\u6a21\u5f0f\u540d\u79f0\u3002\nmssql://username:password@host/database?currentSchema=my_schema\n\n# \u901a\u8fc7\u63d0\u4f9b\u989d\u5916\u7684 trustCertificate \u67e5\u8be2\u53c2\u6570\u6765\u4fe1\u4efb\u540c\u884c\u8bc1\u4e66\u3002\nmssql://username:password@host/database?trustCertificate=true\n")),(0,a.yg)("p",null,"SeaORM X \u5b8c\u5168\u652f\u6301 Loco \u5e76\u4e0e\u8bb8\u591a Web \u6846\u67b6\u65e0\u7f1d\u96c6\u6210\uff1a"),(0,a.yg)("ul",null,(0,a.yg)("li",{parentName:"ul"},"Actix"),(0,a.yg)("li",{parentName:"ul"},"Axum"),(0,a.yg)("li",{parentName:"ul"},"Async GraphQL"),(0,a.yg)("li",{parentName:"ul"},"jsonrpsee"),(0,a.yg)("li",{parentName:"ul"},"Loco"),(0,a.yg)("li",{parentName:"ul"},"Poem"),(0,a.yg)("li",{parentName:"ul"},"Salvo"),(0,a.yg)("li",{parentName:"ul"},"Tonic")),(0,a.yg)("p",null,"\u795d\u4f60\u7f16\u7801\u6109\u5feb\uff01"),(0,a.yg)("pre",null,(0,a.yg)("code",{parentName:"pre"},"")))}u.isMDXComponent=!0}}]);